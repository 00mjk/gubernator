#! /bin/sh

# Make sure the script fails fast.
set -e
set -u
set -x

PROTO_DIR=./proto
GO_DIR=./golang/pb

# Cleanup outdated autogenerated files.
rm -f $GO_DIR/*.go

protoc -I=$PROTO_DIR \
    -I=$GOPATH/pkg/mod/github.com/grpc-ecosystem/grpc-gateway\@v1.7.0/third_party/googleapis \
    --go_out=plugins=grpc:$GO_DIR \
    $PROTO_DIR/*.proto

protoc -I=$PROTO_DIR \
    -I=$GOPATH/pkg/mod/github.com/grpc-ecosystem/grpc-gateway\@v1.7.0/third_party/googleapis \
    --grpc-gateway_out=logtostderr=true:$GO_DIR \
    $PROTO_DIR/*.proto
